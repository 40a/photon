---
azs:
  proxmox:
    inventory: inventory/fusion/metapod/proxmox
    env:
      ANSIBLE_VAULT_PASSWORD_FILE: ~/.config/ansible-systems/vault-proxmox.pass
  proxmox2:
    inventory: inventory/fusion/metapod/proxmox
    env:
      ANSIBLE_VAULT_PASSWORD_FILE: ~/.config/ansible-systems/vault-proxmox.pass

workflows:
  update_passwords:
    # passed to all playbooks in this workflow
    flags:
      - --become
    playbooks:
      - path: playbooks/openstack/metapod/change_passwords/percona_cinder.yml
        # passed only to this playbook
        flags:
          - --tags="update_percona_passwords"
          - --extra-vars="cinder_in_use=True"

  test_password_playbooks:
    # all by default, this allows us to lock a workflow to a particular az
    # in this case, we can't run our test password playbooks against anything but proxmox
    allowed_azs:
      - proxmox
    playbooks:
      - path: playbooks/openstack/metapod/tests/percona_cinder.yml
        flags:
          - --tags=update_percona_passwords
      - path: playbooks/openstack/metapod/tests/percona_keystone.yml
        flags:
          - --tags=update_percona_passwords
      - path: playbooks/openstack/metapod/tests/percona_xtrabackup.yml
        flags:
          - --tags=update_percona_cluster_pw
